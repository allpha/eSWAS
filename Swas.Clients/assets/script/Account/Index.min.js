function updateErrorEditor(n,t){var i=$(n);i.text(t);i.append(' <button class="close" data-close="alert"><\/button> ');i.show()}function hideErrorEditor(n){var t=$(n);t.hide()}function updataErrorEditorByValidatorError(n,t){var i,u,r;if(t!=null){for(i=$(n),i.text(""),i.append(' <button class="close" data-close="alert"><\/button> '),u="",r=0;r<t.length;r++)i.append(t[r].element.placeholder+" - "+t[r].message+"<br />");i.show()}}function login(){BusyIndicator.setBusy();$.ajax({url:"/Account/LogIn",type:"POST",dataType:"json",data:{userName:$("#username").val(),password:$("#password").val()},success:function(n){!n.ok&&n.needChangePassword?($(".login-form").hide(),$(".forget-form").show()):n.ok&&!n.needChangePassword&&(window.location=n.newurl);BusyIndicator.unsetBusy()},error:function(n){updateErrorEditor("#errorEditor",n.responseText);BusyIndicator.unsetBusy()}})}function changePassword(){BusyIndicator.setBusy();$.ajax({url:"/Account/FirstLoginChangePasswrod",type:"POST",dataType:"json",data:{newPassword:$("#newPassword").val(),retryNewPassword:$("#reNewPassword").val()},success:function(n){n.ok&&!n.needChangePassword&&(window.location=n.newurl);BusyIndicator.unsetBusy()},error:function(n){updateErrorEditor("#changePasswordErrorEditor",n.responseText);BusyIndicator.unsetBusy()}})}var Login=function(){var n=function(){$(".login-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{username:{required:!0},password:{required:!0}},invalidHandler:function(n,t){updataErrorEditorByValidatorError("#errorEditor",t.errorList)},highlight:function(n){$(n).closest(".form-group").addClass("has-error")},success:function(n){n.closest(".form-group").removeClass("has-error");n.remove()},errorPlacement:function(n,t){n.insertAfter(t.closest(".input-icon"))},submitHandler:function(){login()}});$(".login-form input").keypress(function(n){if(n.which==13)return $(".login-form").validate().form()&&$(".login-form").submit(),!1});$(".forget-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{newPassword:{minlength:6,required:!0},reNewPassword:{minlength:6,equalTo:"#newPassword",required:!0}},invalidHandler:function(n,t){updataErrorEditorByValidatorError("#changePasswordErrorEditor",t.errorList)},highlight:function(n){$(n).closest(".form-group").addClass("has-error")},success:function(n){n.closest(".form-group").removeClass("has-error");n.remove()},errorPlacement:function(n,t){n.insertAfter(t.closest(".input-icon"))},submitHandler:function(){changePassword()}});$(".forget-form input").keypress(function(n){if(n.which==13)return $(".forget-form").validate().form()&&$(".forget-form").submit(),!1});$("#back-btn").click(function(){hideErrorEditor("#errorEditor");$(".login-form").show();$(".forget-form").hide()})};return{init:function(){$(".forget-form").hide();n();$(".login-bg").backstretch(["../assets/css/IMG_7370.jpg"],{fade:1e3,duration:8e3})}}}();jQuery(document).ready(function(){BusyIndicator.init("#MainForm");Login.init()});